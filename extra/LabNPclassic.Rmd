---
title: "Test Non-Parametrici Classici"
author: ''
date: ''
output: pdf_document
---


### Dataset Cholesterol

L'obiettivo dello studio è di stabilire se una dieta a base di pesce diminuisce il livello di colesterolo rispetto ad una dieta a base di carne (Ludbrook and Dudley, 1998). A questo scopo, 12 soggetti sono stati assegnati casualmente alle due diete: 7 alla dieta a base di pesce, e 5 alla dieta a base di carne. Dopo un anno, è stato misurato il loro livello di colesterolo:

```{r}
# pulizia del workspace
rm(list=ls())

fish = c(5.42, 5.86, 6.16, 6.55, 6.8, 7, 7.11)
meat = c(6.51, 7.56, 7.61, 7.84, 11.5)
```

Il diagramma a scatola con baffi (*boxplot*) è il seguente:

```{r}
boxplot(fish,meat, 
        names=c("fish","meat"), 
        horizontal = T)
```

**Test $t$ di Student per due campioni indipendenti** 

```{r}
t.test(meat,fish, 
       alternative = "greater", 
       var.equal = TRUE)

# per i dati trasformati in logaritmo
t.test(log(meat), log(fish), 
       alternative = "greater",
       var.equal = TRUE)
```

**Test di Wilcoxon-Mann-Whitney** 

```{r}
wilcox.test(meat, fish, 
            alternative="greater",
            exact=FALSE, 
            correct=FALSE)

# con correzione per la continuità
wilcox.test(meat, fish,
            alternative="greater",
            exact=FALSE, 
            correct=TRUE)

# il risultato non cambia per i dati trasformati in logaritmo
wilcox.test(log(meat), log(fish), 
            alternative="greater",
            exact=FALSE, 
            correct=TRUE)
```

**Test di Kolmogorov-Smirnov**

```{r}
# funzione di ripartizione empirica
plot( ecdf(fish), 
     verticals = TRUE, 
     do.points=FALSE, 
     xlim=c(min(fish,meat),max(fish,meat)),
     main=""
     )
lines(ecdf(meat), 
      verticals = TRUE, 
      do.points=FALSE, 
      col="red")

ks.test(fish, meat,
        alternative="greater",
        exact=FALSE)

```



**Test di Welch**

```{r}
var(meat)/var(fish)

t.test(meat, fish, 
       alternative="greater",
       var.equal = FALSE)

# per i dati trasformati in logaritmo
var(log(meat))/var(log(fish))
t.test(log(meat), log(fish), 
       alternative = "greater",
       var.equal = FALSE)
```


**Test di Brunner e Munzel**

```{r, message=F}
# dati in formato data.frame
dati = data.frame(
       colesterolo=c(fish,meat),
       dieta = c(rep("fish",length(fish)),
                 rep("meat",length(meat)))
       )

require("nparcomp")
summary(
npar.t.test(colesterolo ~ dieta, data = dati,
            alternative="greater",
            method = "t.app",
            info = FALSE)
)
```



### Dataset ECMO 

L'ECMO o *ExtraCorporeal Membrane Oxygenation* (in italiano Ossigenazione Extracorporea a Membrana) è una tecnica di circolazione extracorporea utilizzata in ambito di rianimazione per trattare pazienti con insufficienza respiratoria. 
Here, 39 neonates with severe pulmunary hypertension and respiratory failure were randomly allocated to ECMO or conventional medicat therapy (CMT). Among the 5 babies died, 4 were treated with CMT and among the 34 babies survided, 6 were treated with CMT.


```{r}
ecmo = matrix(c(4,6,
                1,28), 
                   ncol=2,
                   byrow=T, 
                   dimnames = 
list( Treatment=c("CMT","ECMO"), 
      Outcome=c("Died","Lived")
))

ecmo
```

**Test Chi-quadrato**

```{r}
chisq.test(ecmo)

# frequenze attese
chisq.test(ecmo)$expected

# senza correzione per la continuità 
chisq.test(ecmo, correct=F)

# confronto due proporzioni
prop.test(x=c(4,1), n=c(10,29),
          alternative="greater")

```


**Test esatto di Fisher**

```{r}
fisher.test(ecmo,
            alternative="greater")
```

### Dataset SAR

Nineteen patients with asthma were enrolled in a study to
investigate the respiratory effects of sulfur dioxide.
Measurements specific airway resistance (SAR) were
measured from patients in the following way. First, SAR was
measured while at rest, then after 5 minutes of exercising.
This gives an increase in SAR. This was done while patients
breathed "normal" air , and while subjected to 0.25 ppm SO2.
Thus, two measurements of increased SAR were obtained
from each patient. 

```{r}
Air = c(.82, .86, 1.86, 1.64, 12.57, 1.56, 1.28, 1.08, 4.29, 1.34, 14.68, 3.64, 3.89, .58, 9.50, .93, 0.49, 31.04, 1.66)
SO2 = c(.72, 1.05, 1.40, 2.30, 13.49, .62, 2.41, 2.32, 8.19, 6.33, 19.88,8.87,9.25, 6.59, 2.17, 9.93,13.44,16.25,19.89)
n = length(Air)

boxplot(Air,SO2, names=c("Air","SO2"), log="y", outline=T)
stripchart(list(Air, SO2), vertical = T, pch = "+",  add = T, col = "blue")
segments(rep(1, length(Air))[1:n], Air[1:n], 
         rep(2, length(SO2))[1:n], SO2[1:n], 
    col = 1, lwd = 0.5)

# differenze
Dif = SO2 - Air

# box-plot delle differenze
boxplot(Dif, horizontal = T)
```

**Test t di Student per dati appaiati**

```{r}
t.test(SO2, Air,
       pair=TRUE, 
       alternative="greater") 

# fornisce lo stesso risultato
t.test(Dif,
       alternative="greater") 
```

**Test dei ranghi con segno di Wilcoxon**

```{r}
wilcox.test(SO2, Air, 
            pair=TRUE,
            exact=FALSE,
            correct=TRUE,
            alternative="greater")
```

## Dataset AHR

Airway hyper-responsiveness (AHR) status—an indication of pulmonary complications—was measured in 21 children before and after stem cell transplantation (SCT). The incidence of AHR increased from two (9.5%) children before SCT to eight (38%) children after SCT (Bentur et al., 2009)

```{r}
AHR = matrix(c(1,1,
               7,12), 
              ncol=2,
              byrow=T, 
              dimnames = list( BeforeSCT=c("AHR","No AHR"), 
                               AfterSCT=c("AHR","No AHR")
                                    ))
AHR
```

**Test di McNemar**

```{r}
mcnemar.test(AHR)

# senza correzione per la continuità
mcnemar.test(AHR,correct=FALSE)

# test esatto
binom.test(c(1, 7), p=0.5, alternative = "less")
```